<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>åˆç´„çé‡‘åˆ†æ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <style>
        :root {
            --primary-color: #34495e;
            --secondary-color: #ecf0f1;
            --accent-color: #3498db;
            --text-color: #2c3e50;
            --background-color: #f5f7fa;
        }
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            font-size: 16px;
            line-height: 1.5;
        }
        .container {
            width: 100%;
            max-width: 100%;
            margin: 0 auto;
            padding: 1rem;
        }
        h1 {
            color: var(--primary-color);
            text-align: center;
            font-weight: 600;
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }
        .card {
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 0.25rem 0.5rem rgba(0, 0, 0, 0.05);
            padding: 1rem;
            margin-bottom: 1rem;
        }
        .card-title {
            color: var(--primary-color);
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            text-align: center;
        }
        .table-container {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            margin-bottom: 1rem;
        }
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }
        th, td {
            padding: 0.75rem;
            text-align: left;
            white-space: nowrap;
            font-size: 0.875rem;
        }
        th {
            background-color: var(--secondary-color);
            color: var(--primary-color);
            font-weight: 600;
        }
        tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        .chart-container {
            height: 70vh;
            max-height: 500px;
            width: 100%;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
        }
        .chart-wrapper {
            flex-grow: 1;
            width: 100%;
            position: relative;
        }
        .crown {
            font-size: 1em;
            margin-left: 0.25rem;
        }
        .hue-chart-container {
            height: 50vh;
            max-height: 400px;
            width: 100%;
            position: relative;
        }
        
    </style>
</head>
<body>
    <div class="container">
        <h1>åˆç´„çé‡‘åˆ†æ</h1>
        
        <div class="card">
            <div class="card-title">çé‡‘æ˜ç´°</div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>å¥‘ç´„äºº</th>
                            <th>åˆç´„çé‡‘</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>å¹¸é›…èŠ³</td>
                            <td>3,600.0</td>
                        </tr>
                        <tr>
                            <td>å½­å­èŠ¸</td>
                            <td>201,750.0</td>
                        </tr>
                        <tr>
                            <td>æ½˜å§¿è</td>
                            <td>1,162,980.0</td>
                        </tr>
                        <tr>
                            <td>ç‹ç¾¿æ·¨<span class="crown">ğŸ‘‘</span></td>
                            <td>1,345,000.0</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="card">
            <div class="card-title">çé‡‘åˆ†ä½ˆ</div>
            <div class="chart-container">
                <div class="chart-wrapper">
                    <canvas id="contractChart"></canvas>
                </div>
            </div>
        </div>
        <div class="card">
            <div class="card-title">çé‡‘èˆ‡æˆæœ¬å°æ¯”</div>
            <div class="hue-chart-container">
                <canvas id="hueChart"></canvas>
            </div>
        </div>
    </div>
    

    <script>
        Chart.register(ChartDataLabels);
        const ctx = document.getElementById('contractChart').getContext('2d');
        const data = [3600.0, 201750.0, 1162980.0, 1345000.0];
        const labels = ['å¹¸é›…èŠ³', 'å½­å­èŠ¸', 'æ½˜å§¿è', 'ç‹ç¾¿æ·¨'];
        const maxIndex = data.indexOf(Math.max(...data));
        
        new Chart(ctx, {
            type: 'pie',
            data: {
                labels: labels,
                datasets: [{
                    data: data,
                    backgroundColor: [
                        '#34495e',
                        '#3498db',
                        '#1abc9c',
                        '#9b59b6'
                    ],
                    borderColor: 'white',
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    },
                    datalabels: {
                        color: '#2c3e50',
                        textAlign: 'center',
                        font: {
                            weight: 'bold',
                            size: 12
                        },
                        formatter: (value, ctx) => {
                            let sum = data.reduce((a, b) => a + b, 0);
                            let percentage = (value * 100 / sum).toFixed(1) + "%";
                            return `${ctx.chart.data.labels[ctx.dataIndex]}\n${percentage}`;
                        },
                        anchor: 'end',
                        align: 'end',
                        offset: 10,
                        textStrokeColor: 'white',
                        textStrokeWidth: 2,
                        textShadowColor: 'rgba(0, 0, 0, 0.5)',
                        textShadowBlur: 3
                    }
                },
                layout: {
                    padding: {
                        top: 50,
                        right: 20,
                        bottom: 20,
                        left: 20
                    }
                },
                radius: '80%',
                rotation: 20
            }
        
        });
        // æ–°å¢HUEç›´æ¢åœ–ä»£ç¢¼
        const hueCtx = document.getElementById('hueChart').getContext('2d');
        const hueLabels = ['å¼µå®›æ™´', 'æ½˜å§¿è', 'ç‹ç¾¿æ·¨'];
        const contractBonus = [48000.0, 1152850.0, 423600.0];
        const totalCost = [47350, 741860, 344750];
        
        new Chart(hueCtx, {
            type: 'bar',
            data: {
                labels: hueLabels,
                datasets: [
                    {
                        label: 'åˆç´„çé‡‘',
                        data: contractBonus,
                        backgroundColor: 'rgba(54, 162, 235, 0.8)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    },
                    {
                        label: 'ç¸½æˆæœ¬',
                        data: totalCost,
                        backgroundColor: 'rgba(255, 99, 132, 0.8)',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 1
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        stacked: false
                    },
                    y: {
                        stacked: false,
                        beginAtZero: true
                    }
                },
                plugins: {
                    legend: {
                        position: 'top',
                        align: 'start',
                        labels: {
                            boxWidth: 12,
                            padding: 8,
                            font: {
                                size: 12
                            }
                        }
                    },
                    datalabels: {
                        anchor: 'end',
                        align: 'top',
                        formatter: (value, context) => {
                            const datasetIndex = context.datasetIndex;
                            const index = context.dataIndex;
                            if (datasetIndex === 1) { // ç¸½æˆæœ¬
                                const bonus = contractBonus[index];
                                const cost = value;
                                const decrease = ((bonus - cost) / bonus * 100).toFixed(1);
                                if (decrease > 0) {
                                    return `${value.toLocaleString()}\nâ†“ ${decrease}%`;
                                }
                            }
                            return value.toLocaleString();
                        },
                        font: {
                            weight: 'bold',
                            size: 12
                        },
                        color: (context) => {
                            return context.datasetIndex === 1 ? 'rgba(255, 99, 132, 1)' : 'rgba(54, 162, 235, 1)';
                        }
                    }
                }
            }
        });
    </script>
</body>
</html>